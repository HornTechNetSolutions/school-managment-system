// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
  engineType = "binary"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  TEACHER
  STUDENT
  PARENT
  EMPLOYEE
}

enum Status {
  ACTIVE
  SUSPENDED
  INACTIVE
}

enum EmployeeRole {
  PRINCIPAL
  VICE_PRINCIPAL
  ACCOUNTANT
  LIBRARIAN
  DRIVER
  NURSE
  SECURITY
  CLEANER
  IT_SUPPORT
  OFFICE_STAFF
}

model users {
  id              String   @id @default(uuid())
  fullName        String
  email           String   @unique
  password        String
  phone           String?
  role            Role
  status          Status   @default(ACTIVE)

  studentNumber   String?  @unique
  employeeNumber  String?  @unique
  parentNumber String? @unique

  student     Student?
  teacher     Teacher?
  parent      Parent?
  admin       Admin?
  employee    Employee?

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  RefreshToken RefreshToken[]
}

model Student {
  id        String   @id @default(uuid())
  user      users   @relation(fields: [userId], references: [id])
  userId    String @unique
  parentId  String?

  studentUuid String @unique @default(uuid())

  parent    Parent?  @relation(fields: [parentId], references: [id])

  classId   String?
  class     Class?   @relation(fields: [classId], references: [id])

  submissions AssignmentSubmission[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Teacher {
  id        String  @id @default(uuid())
  user        users   @relation(fields: [userId], references: [id])
  userId    String  @unique

  teacherUuid String @unique @default(uuid())

  subject   String?
  classes   Class[] 
  assignments Assignment[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  AssignmentSubmission AssignmentSubmission[]
}

model Parent {
  id        String     @id @default(uuid())
  userId    String     @unique

  user       users   @relation(fields: [userId], references: [id])
  parentUuid String @unique @default(uuid())
  children  Student[]  

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Admin {
  id        String  @id @default(uuid())
  userId    String  @unique

  user      users   @relation(fields: [userId], references: [id])
  adminUuid String @unique @default(uuid())

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Employee {
  id            String        @id @default(uuid())
  user          users   @relation(fields: [userId], references: [id])
  userId        String        @unique
  role          EmployeeRole
  department    String?

 
  employeeUuid String @unique @default(uuid())
  title        String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Class {
  id        String    @id @default(uuid())
  name      String
  grade     Int

  teacherId String?
  teacher   Teacher?  @relation(fields: [teacherId], references: [id])

  students  Student[]
  assignments Assignment[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Assignment {
  id           String    @id @default(uuid())
  teacherId    String
  classId      String
  title        String
  description  String?
  dueDate      DateTime

  teacher      Teacher   @relation(fields: [teacherId], references: [id])
  class        Class     @relation(fields: [classId], references: [id])

  submissions  AssignmentSubmission[]

  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
}

model AssignmentSubmission {
  id            String   @id @default(uuid())
  assignmentId  String
  studentId     String
  content       String?
  fileUrl       String?
  score         Int?
  gradedById    String?
  submittedAt   DateTime @default(now())
  gradedAt      DateTime?

  assignment    Assignment @relation(fields: [assignmentId], references: [id])
  student       Student    @relation(fields: [studentId], references: [id])
  gradedBy      Teacher?   @relation(fields: [gradedById], references: [id])
}

model RefreshToken {
  id     String @id @default(uuid())
  token  String
  userId String
  user   users   @relation(fields: [userId], references: [id])
  createdAt DateTime @default(now())
}